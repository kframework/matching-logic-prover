\documentclass{article}

\usepackage{amsmath,amssymb,amsthm}
\usepackage{fullpage}
\usepackage{hyperref}
\usepackage{mathtools}
\usepackage{xspace}

\input{newcommands}

\title{All Coq Rules in One Place}
\author{Xiaohong Chen}

\begin{document}

\maketitle

\begin{abstract}
This document summarizes all the proof rules of the Coq proof assistant,
as listed in 
\url{https://coq.inria.fr/distrib/current/refman/language/cic.html}.
\end{abstract}

\section{Syntax}

Let us fix a countably infinite set $\V$ of \emph{variables}, denoted 
$x,y,\dots$. 
Let us fix a countably infinite set $\C$ of \emph{constants}, denoted
$c,d,\dots$.

\begin{definition}
We define the set \CoqTerm to be the smallest set that satisfies the following 
conditions:
\begin{enumerate}
\item $\SProp,\Prop,\Set \in \CoqTerm$; $\Type(i) \in \CoqTerm$ for every $i 
\in \NN$. 
\item $\V \subseteq \CoqTerm$.
\item $\C \subseteq \CoqTerm$.
\item If $x \in \V$ and $T,U \in \CoqTerm$, 
      then $\cfa{x}{T}{U} \in \CoqTerm$.
\item If $x \in \V$ and $T,u \in \CoqTerm$,
      then $\clm{x}{T}{u} \in \CoqTerm$.
\item If $t,u \in \CoqTerm$,
      then $\cpp{t}{u} \in \CoqTerm$, called \emph{application}.
\item If $x \in \V$ and $t,T,u \in \CoqTerm$,
      then $\clt{x}{t}{T}{u} \in \CoqTerm$.
\end{enumerate}
where $\cfa{x}{T}{U}$ binds $x$ to $U$
and $\clm{x}{T}{u}$ binds $x$ to $u$.
We use $\FV(T) \subseteq \V$ to denote the set of free variables in $T \in 
\CoqTerm$. 
For $T,U \in \CoqTerm$ and $x \in \V$, 
we use $\sbs{T}{U}{x}$ to denote the result of substituting $U$ for $x$ in $T$,
where $\alpha$-renaming happens implicitly to prevent variable capture.
\end{definition}

\begin{definition}
We define the set 
$\CoqSort = \{\SProp,\Prop,\Set\} \cup \{\Type(i) \mid i \in \NN\}$.
Note that $\CoqSort \subseteq \CoqTerm$. 
Elements in $\CoqSort$ are called \emph{sorts} and denoted as $s$,
possibly with subscripts.
\end{definition}

\begin{definition}
A \emph{local assumption} is written $\lasm{x}{T}$, where $x \in \V$ and $T \in 
\CoqTerm$. 
A \emph{local definition} is written $\ldef{x}{u}{T}$,
where $x \in \V$ and $u,T \in \CoqTerm$.
In both cases, we call $x$ the \emph{declared variable}. 
A \emph{local context} is an ordered list of local assumptions and local 
definitions, such that the declared variables are all distinct. 
We use $\Gamma$, possibly with subscripts, to denote local contexts. 
\end{definition}

\begin{notation}
We use the notation $[\lasm{x}{T} \scln \ldef{y}{u}{U} \scln \lasm{z}{V}]$
to denote the local context that consists of
the local assumption $\lasm{x}{T}$,
the local definition $\ldef{y}{u}{U}$
and the local assumption $\lasm{z}{V}$,
with the implicit requirement that $x,y,z$ are all distinct.
The empty local context is written as $[]$. 
Let $\Gamma$ be a local context. 
We write $x \in \Gamma$ to mean that $x$ is declared in $\Gamma$.
We write $(\lasm{x}{T}) \in \Gamma$ to mean that the local assumption
$\lasm{x}{T}$ is in $\Gamma$, or that
the local definition $\ldef{x}{u}{T}$ is in $\Gamma$ for some $u \in \CoqTerm$.
We write $(\ldef{x}{u}{T}) \in \Gamma$ to mean that
the local definition $\ldef{x}{u}{T}$ is in $\Gamma$.
We write $\Gamma \dcln ( \lasm{x}{T} )$ to denote the local context
that enriches $\Gamma$ with $\lasm{x}{T}$, with the implicit requirement that 
$x \not\in \Gamma$.
Similarly, we write 
$\Gamma \dcln ( \ldef{x}{u}{T} )$ to denote the local context
that enriches $\Gamma$ with $\ldef{x}{u}{T}$, with the implicit requirement 
that $x \not\in \Gamma$.
We write $\Gamma_1 \scln \Gamma_2$ to mean the local context
obtained by concatenating $\Gamma_1$ and $\Gamma_2$, with the implicit 
requirement that all variables declared in $\Gamma_2$ are not declared in 
$\Gamma_1$. 
\end{notation}

\begin{definition}
A \emph{global assumption} is written $(\gasm{x}{T})$, where $c \in \C$ and $T \in 
\CoqTerm$. 
A \emph{global definition} is written $\gldef{c}{u}{T}$,
where $c \in \C$ and $u,T \in \CoqTerm$.
In both cases, we call $c$ the \emph{declared constant}. 
A \emph{global environment} is an ordered list of global assumptions and global
definitions.
We use $E$, possibly with subscripts, to denote global environments.
\end{definition}

\begin{notation}
We use the notation $\gasm{c_1}{T} \scln \gldef{c_2}{u}{U} \scln \gasm{c_3}{V}$
to denote the local context that consists of
the global assumption $\gasm{c_1}{T}$,
the global definition $\gldef{c_2}{u}{U}$
and the global assumption $\gasm{c_3}{V}$.
The empty global context is written as $[]$. % TODO: is this right?
Let $E$ be a local context. 
We write $c \in E$ to mean that $c$ is declared in $E$.
We write $(\gasm{c}{T}) \in E$ to mean that the global assumption
$\gasm{c}{T}$ is in $E$, or that
the global definition $\gldef{c}{u}{T}$ is in $E$ for some $u \in \CoqTerm$.
We write $(\gldef{c}{u}{T}) \in E$ to mean that
the global definition $\gldef{c}{u}{T}$ is in $E$.
We write $E \scln \gasm{c}{T}$ to denote the global context
that enriches $E$ with $\gasm{c}{T}$.
Similarly, we write 
$E \scln \gldef{c}{u}{T}$ to denote the global context
that enriches $E$ with $( \gldef{c}{u}{T} )$.
\end{notation}

\begin{notation}
We write $E[\Gamma] \proves \lasm{u}{T}$ to mean that $u$ is well-typed with
type $T$ in global environment $E$ and local environment $\Gamma$.
We write $\wf(E)[\Gamma]$ to mean that the global environment $E$ is well-formed
and $\Gamma$ is a valid local context in $E$.
\end{notation}

\begin{definition}
A term $u$ is \emph{well-typed} in a global environment $E$ if there is a
local environment $\Gamma$ and type $T$ such that
$E[\Gamma] \proves \lasm{u}{T}$ is derivable with the rules below.
\end{definition}

\section{Coq Typing Rules}

\end{document}
