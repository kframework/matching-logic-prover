#!/usr/bin/env python3

import os
import subprocess
import sys

# Bootstrapping
# =============

# Make sure the KNinja repo is available.
subprocess.check_call(['git', 'submodule', 'update', '--init'])
extdir = 'ext'
sys.path.append(os.path.join(os.path.dirname(__file__), extdir))
from kninja import *

# Build
# =====

proj = KProject()
prover = \
    proj.definition( alias    = 'prover'
                   , backend  = 'java'
                   , main     = 'prover.md'
                   , other    = ['direct-proof.md', 'kore.md', 'smtlib2.md', 'predicate-definitions.md']
                   )
smtlib_testdriver = \
    proj.definition( alias    = 'smtlib-testdriver'
                   , backend  = 'java'
                   , main     = 'prover.md'
                   , other    = ['direct-proof.md', 'kore.md', 'smtlib2.md', 'predicate-definitions.md']
                   , flags = "--main-module SMTLIB2-TEST-DRIVER --syntax-module SMTLIB2-TEST-DRIVER"
                   )

# Matching Logic Prover
# =====================

prover.tests(glob = 't/*.prover')

# SMTLIB Translation
# ==================

smtlib_testdriver.proofs( alias = 'smtlib2-tests'
                        , glob  = proj.tangle('smtlib2-tests.md').path
                        )
proj.main()
